---
title: "はじめて学ぶバイナリ解析 を読んだ"
type: "post"
draft: false
date: "2022-01-18T05:28:15+09:00"
---

[はじめて学ぶバイナリ解析 不正なコードからコンピュータを守るサイバーセキュリティ技術](https://nextpublishing.jp/book/11353.html) を読み終えました。

## 概要

VMwareやVirtualBoxのような仮想環境を用いて、以下のトピックを手を動かしながら学ぶ。

- 脆弱性とは何か
- アセンブラについて
- バイトオーダー(リトルエンディアン)について
- メモリレイアウトについて(スタック領域)
- レジスタについて
- アセンブリを書いてシステムコールを使う(`int 0x80`)
- gdb-pedaの使い方
- リターンアドレスの書き換え、ret2libc
- shellcode

私は4回に分けて3時間ほどで読み終えました。事前知識としてアセンブリ等はすでに知っていたので、この分野をよく知らなかったらもう少し時間がかかっていたと思います。

この本の良さは「バイナリ解析は理論と観測の2つのアプローチを交えて動作を解析することが大切」という本の中で出てくる言葉に集約されていて、理論面(紙とかにメモリレイアウトを書く)、観測(gdbを動かして様子を観察する)を両方行うことが大切だと感じました。同時に、ステップアップして理解していけるような例を構成できる力も大事だなと思いました。

## できるようになったこと

- スタック、特にESPとかの動きを自信を持って答えられるようになった
- リトルエンディアンについて、気にしなきゃいけない状態の条件をきっちり理解した
- 32bitでSSP無効ASLRオフでのバッファオーバーフローのExploitが書けるようになった
- ret2libcとshellcodeを部分的に理解した
- `int 0x80` を使ったシステムコールのアセンブリでの呼び方を理解して実際に書いた

## 本を読んでいる途中気づいたこと

- **仮想環境の環境構築の話**: VMwareを使った。ovaをgoogle driveからダウンロードしてそのままVMwareで開ける雰囲気がするがうまく行かない。本にも書いてあるが、ovaファイルは解凍できるので解凍してovfファイルをインポートしよう。
- **仮想環境の環境構築の話**: ovfファイルをインポートするときにインポートに何回か失敗する。Document以下にディレクトリを作ろうとしてWindows Defenderにブロックされていたことが原因だった。
- **Ubuntuの設定の話**: キーボード配列はデフォルトで日本語なので、USキーボードならsettingsを開いて日本語を消すとUSのみになる。

## 今後やりたいこと

- セキュアコーディング系の読み物を読む: https://www.jpcert.or.jp/securecoding/ など
- ret2libcとshellcodeの理解が浅いので、手を動かして学ぶ(例題探す)
- pwntools, gdb-pedaの使い方を、簡単な例題と共にチートシート作る https://github.com/bet4it/hyperpwn これ気になるので使ってみたい
- SSP, ASLRなどのセキュリティ機構を調べる
  - ASLRについては [satさんのyoutube](https://www.youtube.com/watch?v=iCCNEoCKdHE) がとっかかりとしてよかった
