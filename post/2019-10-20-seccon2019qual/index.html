<!doctype html><html lang=ja><head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1">
<title>SECCON CTF 2019 qual Writeup</title>
<link rel=stylesheet href=/sass/main.min.1e6313427b6aca7a7b8a243e45fb955d99cad3ab0ffd4851aee551953705b8ad.css>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css integrity=sha384-KiWOvVjnN8qwAZbuQyWDIbfCLFhLXNETzBQjA/92pIowpC0d2O3nppDGQVgwd2nB crossorigin=anonymous>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js integrity=sha384-0fdwu/T/EQMsQlrHCCHoH10pkPLlKA1jL5dFyUOvB3lfeT2540/2g6YgSi2BL14p crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous onload=renderMathInElement(document.body)></script>
<script defer>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script>
<script defer src=/js/prism.min.js></script>
<link rel=stylesheet href=/css/prism.min.css>
</head>
<body>
<main id=content>
<p class=category>
カテゴリー: <a href=/post>post</a>
</p>
<article class=suuri><p>2019/10/19(土)15:00-2019/10/20(日)15:00 まで開催されていた、SECCON CTF 2019 qual にチーム StarrySky で参加していました。今回は mitsu さんが基本情報を受けるのでお休みで、一人チームでの参加となりました。<br>
結果は Welcome, Thank you for playing!, coffee_break, Sandstorm, ZKPay の 5 問を解いて 743 ポイントを獲得し 102 位(正の得点を取った人数は 799 人)でした。以下、解いたものの Writeup を書きます。</p>
<h1 id=welcome>Welcome</h1>
<pre tabindex=0><code>Welcome to the SECCON CTF.

Read rules and check the IRC topic.
</code></pre><p>IRC に行くと flag が書かれています。<br>
<code>SECCON{Welcome to the SECCON 2019 Online CTF}</code></p>
<h1 id=thank-you-for-playing>Thank you for playing!</h1>
<pre tabindex=0><code>SECCON{We have done all the challenges. Thank you!}
</code></pre><p>そのままです<br>
<code>SECCON{We have done all the challenges. Thank you!}</code></p>
<h1 id=coffee_break>coffee_break</h1>
<pre tabindex=0><code>The program &quot;encrypt.py&quot; gets one string argument and outputs ciphertext.

Example:

$ python encrypt.py &quot;test_text&quot;
gYYpbhlXwuM59PtV1qctnQ==
The following text is ciphertext with &quot;encrypt.py&quot;.

FyRyZNBO2MG6ncd3hEkC/yeYKUseI/CxYoZiIeV2fe/Jmtwx+WbWmU1gtMX9m905

Please download &quot;encrypt.py&quot; from the following url.

encrypt.py
</code></pre><h1 id=sandstorm>Sandstorm</h1>
<pre tabindex=0><code>I've received a letter... Uh, Mr. Smith?
</code></pre><p>最初はいつものように file, foremost, stegsolve, exiftool をかけて調べました。<br>
exiftool で妙なものを見つけます。<br>
<code>Interlace : Adam7 Interlace</code><br>
Adam と画像に書いてあるし関係ありそうです。調べてみると、先に画像の一部を送り、徐々に後から追加情報を送ることで、解像度が低くともおおまかな情報を伝えられるみたいなアルゴリズムだと理解しました。<br>
では手元の画像で試してみましょう。(これは僕が所属している、広島でセキュリティ勉強会を開こうとしている団体のロゴです。)ImageMagick を使いました。</p>
<p><img src=./p-1.png alt=p-1.png></p>
<p>この画像に補完なしの Adam7 と、補完ありの Adam7 をかけてみました。<a href=https://blog.awm.jp/2016/01/26/png/>ImageMagick で PNG の形式を変換 2016 awm-Tech</a>を参考にしています。</p>
<pre tabindex=0><code>convert p-1.png -filter Point -fx &quot;!(i%8)*!(j%8)*u&quot; p-2.png
</code></pre><p><img src=./p-2.png alt=p-2.png></p>
<pre tabindex=0><code>convert p-1.png -filter Point -fx &quot;p{i-i%8,j-j%8}&quot; p-3.png
</code></pre><p><img src=./p-3.png alt=p-3.png></p>
<p>なんとなく分かりました。では、問題の画像にもこの処理を加えてみましょう。</p>
<pre tabindex=0><code>convert sandstorm.png -filter Point -fx &quot;p{i-i%8,j-j%8}&quot; p-4.png
</code></pre><p><img src=./p-4.png alt=p-4.png></p>
<p>QR コードが出てきました。これを読み取ると flag が表示されます。なんというか、とりあえず試してみるとできたみたいな感じでした。<br>
<code>SECCON{p0nlMpzlCQ5AHol6}</code></p>
<h1 id=zkpay>ZKPay</h1>
<pre tabindex=0><code>http://153.120.18.131/

status solve

http://133.242.52.44/ (Mirror #2) status solve

http://133.242.17.50/ (Mirror #3) status solve
</code></pre><p>QR コードで amount 100 を指定して読み取ってみると、以下のようになっていました。</p>
<pre tabindex=0><code>username=k&amp;amount=100&amp;proof=MAINjzgVW2vP/wK3J2/a4WRajXpVfS3YSwCQfI00ltkSMSAwvNW5djnZ/RXhkZKRuwMk735s2ktsoHTWppBPm8sRZycwCjCXFnZPpYgC2XLWSeVqJ7A60jyCSuf0Hx7SbMhUxRf0IUHthi/20cbMOa0jreheM1k8Kc2aL4nISx276bO7HIMBMCAwk6ErCRZ2hx9k4zTQtX6Eu3QVU/4UJXtt3D92iepCqxwxCjDw48/TCc3BFznqVcImZBAsr1261pHFLgTac/1ZivV6AjEgMGlQT08rlUPoSQhG2p6oP6SYD30jVoO3MAyHJgZ7pKcTMQowPVt5bRI6qc6nO4lnZI6BDoszMzituoRSxFpY35b9uAcwCjBFDuUef4/weG2bRAiMhljPN3s+6gURwOq4p8VgX/xxDTEK&amp;hash=e403dfc2abe5f320bbf6d92a20b834d36143b89a1da7200dc225fd5c7504a22a
</code></pre><p>試してみると、amount が変化しても proof は変わらず、username と hash が対応しているようです。また、amount に負の数を指定して <a href=https://www.the-qrcode-generator.com/>online QR generate サービス</a> で QR を作るとエラーなく読み込まれます。<br>
そこで 2 つユーザを作り以下のようにしました。</p>
<ul>
<li>まず、<code>username=k&amount=-1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&proof=MAINjzgVW2vP/wK3J2/a4WRajXpVfS3YSwCQfI00ltkSMSAwvNW5djnZ/RXhkZKRuwMk735s2ktsoHTWppBPm8sRZycwCjCXFnZPpYgC2XLWSeVqJ7A60jyCSuf0Hx7SbMhUxRf0IUHthi/20cbMOa0jreheM1k8Kc2aL4nISx276bO7HIMBMCAwk6ErCRZ2hx9k4zTQtX6Eu3QVU/4UJXtt3D92iepCqxwxCjDw48/TCc3BFznqVcImZBAsr1261pHFLgTac/1ZivV6AjEgMGlQT08rlUPoSQhG2p6oP6SYD30jVoO3MAyHJgZ7pKcTMQowPVt5bRI6qc6nO4lnZI6BDoszMzituoRSxFpY35b9uAcwCjBFDuUef4/weG2bRAiMhljPN3s+6gURwOq4p8VgX/xxDTEK&hash=e403dfc2abe5f320bbf6d92a20b834d36143b89a1da7200dc225fd5c7504a22a</code>で QR を作る。</li>
<li>別ユーザでその QR を読み込む<br>
すると、読み込んだユーザは大量の借金を背負い、user k さんはウハウハになりました。</li>
</ul>
<p><img src=./p-5.png alt=p-5.png></p>
<p><img src=./p-6.png alt=p-6.png></p>
<p>これで flag が得られました。<br>
<code>SECCON{y0u_know_n07h1ng_3xcep7_7he_f4ct_th47_1_kn0w}</code></p>
<h1 id=終わりに>終わりに</h1>
<p>ギャグみたいな解き方しかできてないのでもっと本質的な解き方ができるようになりたい。Pwn 勉強やるぞやるぞ。</p>
</article>
<footer>
<p class=license>
This document is licensed under
<a href=https://creativecommons.org/licenses/by/4.0/ target=_blank rel="noopener noreferrer">CC-BY-4.0</a>
</p>
<p class=repository>
<a href=https://github.com/uta8a/discussion/discussions/1 target=_blank rel="noopener noreferrer">discussion</a>にコメントする
</p>
</footer>
</main>
</body>
</html>